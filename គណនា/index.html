<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>គណនាពិន្ទុ</title>
    <!-- ផ្ទុក Tailwind CSS CDN ដើម្បីប្រើប្រាស់ Class របស់ Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ផ្ទុក Font Battambang ពី Google Fonts ជា Font ជំនួស -->
    <link href="https://fonts.googleapis.com/css2?family=Battambang&display=swap" rel="stylesheet">
    <style>
        /* កំណត់ Font សម្រាប់រាងកាយទាំងមូលរបស់ឯកសារ */
        /* 'Khmer OS Muol Light' គឺជា Font អាទិភាពទីមួយ, 'Battambang' ជា Font ជំនួស */
        body {
            font-family: 'Khmer OS Muol Light', 'Battambang', sans-serif;
        }

        /* Styles សម្រាប់អក្សររត់ (Marquee Effect) */
        .marquee-container {
            overflow: hidden; /* លាក់អត្ថបទដែលចេញពីតំបន់មើល */
            white-space: nowrap; /* ការពារអត្ថបទមិនឱ្យឡើងបន្ទាត់ថ្មី */
            width: 100%; /* កំណត់ទទឹងពេញ */
        }
        .marquee-text {
            display: inline-block; /* កំណត់ជា inline-block ដើម្បីឱ្យ animation ដំណើរការ */
            animation: marquee 15s linear infinite; /* ចាប់ផ្តើម animation ឈ្មោះ 'marquee' រយៈពេល 15s, ល្បឿនថេរ, ធ្វើម្តងទៀតឥតឈប់ */
        }
        /* កំណត់ keyframes សម្រាប់ animation របស់អក្សររត់ */
        @keyframes marquee {
            0% { transform: translateX(100%); } /* ចាប់ផ្តើមពីខាងស្តាំបំផុត */
            100% { transform: translateX(-100%); } /* រត់ទៅខាងឆ្វេងបំផុត */
        }

        /* លាក់ប៊ូតុងកែតម្រូវលេខ (spinner arrows) នៅក្នុង input type="number" សម្រាប់ WebKit browsers (Chrome, Safari) */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* លាក់ប៊ូតុងកែតម្រូវលេខ (spinner arrows) នៅក្នុង input type="number" សម្រាប់ Firefox */
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 min-h-screen flex items-center justify-center p-4">
    <!-- Main container សម្រាប់កម្មវិធី -->
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-4xl">
        <!-- ផ្នែកអក្សររត់ (Marquee Text) -->
        <div class="marquee-container mb-6 text-2xl font-bold">
            <p class="marquee-text">
                <span class="text-pink-600">សូមស្វាគមន៍</span> <span class="text-red-600">មកកាន់websiគណនាពិន្ទ!</span> <span class="text-pink-600">ដើម្បីទទួលបាននិទ្ទេសល្អ</span> <span class="text-red-600">សូមខិតខំរៀនសូត្រ!🫶</span>
            </p>
        </div>

        <!-- ចំណងជើងកម្មវិធី -->
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-8">គណនាពិន្ទុ</h1>

        <!-- ផ្នែកបញ្ចូលទិន្នន័យ -->
        <div class="space-y-6">
            <!-- ការបញ្ចូលឈ្មោះសិស្ស -->
            <div>
                <label for="studentName" class="block text-gray-700 text-lg font-semibold mb-2">ឈ្មោះសិស្ស:</label>
                <input type="text" id="studentName" placeholder="បញ្ចូលឈ្មោះសិស្ស"
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200">
            </div>

            <!-- ការជ្រើសរើសថ្នាក់ -->
            <div>
                <label for="streamSelect" class="block text-gray-700 text-lg font-semibold mb-2">ជ្រើសរើសថ្នាក់:</label>
                <select id="streamSelect"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 bg-white">
                    <option value="">-- ជ្រើសរើសថ្នាក់ --</option>
                    <option value="science">ថ្នាក់វិទ្យាសាស្រ្តពិត</option>
                    <option value="social">ថ្នាក់វិទ្យាសាស្រ្តសង្គម</option>
                </select>
            </div>

            <!-- ផ្នែកសម្រាប់បញ្ចូលពិន្ទុមុខវិជ្ជា (នឹងត្រូវបានបង្កើតដោយ JavaScript) -->
            <div id="subjectInputs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Subject inputs will be dynamically generated here -->
            </div>

            <!-- ប៊ូតុងគណនា និងកំណត់ឡើងវិញ -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <button id="calculateBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition duration-300">
                    គណនាពិន្ទុ
                </button>
                <button id="resetBtn"
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition duration-300">
                    កំណត់ឡើងវិញ
                </button>
            </div>

            <!-- ផ្នែកបង្ហាញលទ្ធផល -->
            <div id="results" class="mt-10 p-6 bg-gray-50 rounded-xl shadow-inner border border-gray-200">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">លទ្ធផល</h2>
                <!-- លទ្ធផលមុខវិជ្ជានីមួយៗ (នឹងត្រូវបានបង្ហាញដោយ JavaScript) -->
                <div id="individualResults" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Individual subject results will be displayed here -->
                </div>
                <!-- លទ្ធផលសរុប -->
                <div id="overallResult" class="text-center bg-blue-100 p-4 rounded-lg border border-blue-200">
                    <p class="text-xl font-semibold text-gray-700">ពិន្ទុសរុប: <span id="totalScoreDisplay" class="font-bold text-blue-800">0</span></p>
                    <p class="text-xl font-semibold text-gray-700">ភាគរយសរុប: <span id="overallPercentageDisplay" class="font-bold text-blue-800">0.00%</span></p>
                    <p class="text-2xl font-bold text-gray-800 mt-2">និទ្ទេសសរុប: <span id="overallGradeDisplay" class="text-purple-700">F</span></p>
                </div>
            </div>
        </div>

        <!-- ឈ្មោះអ្នកបង្កើត -->
        <p class="text-center text-gray-600 text-sm mt-8">
            បង្កើតដោយ: <span class="font-semibold">Theara</span>
        </p>
    </div>

    <script>
        // កំណត់ព័ត៌មានមុខវិជ្ជានីមួយៗ រួមមានឈ្មោះ និងពិន្ទុអតិបរមា
        const subjects = {
            'science': [
                { name: 'គណិតវិទ្យា', max: 125 },
                { name: 'អក្សរសាស្រ្តខ្មែរ', max: 75 },
                { name: 'រូបវិទ្យា', max: 75 },
                { name: 'គីមីវិទ្យា', max: 75 },
                { name: 'ជីវវិទ្យា', max: 75 },
                { name: 'ភាសាបរទេស', max: 50 },
                { name: 'មុខវិជ្ជាជម្រើស', max: 50 }
            ],
            'social': [
                { name: 'អក្សរសាស្រ្តខ្មែរ', max: 125 },
                { name: 'គណិតវិទ្យា', max: 75 },
                { name: 'ប្រវត្តិវិទ្យា', max: 75 },
                { name: 'ភូមិវិទ្យា', max: 75 },
                { name: 'សីលធម៍', max: 75 },
                { name: 'ភាសាបរទេស', max: 50 },
                { name: 'មុខវិជ្ជាជម្រើស', max: 50 }
            ]
        };

        // មុខងារសម្រាប់កំណត់និទ្ទេសដោយផ្អែកលើភាគរយ
        // និទ្ទេសនេះអាចត្រូវបានកែតម្រូវតាមតម្រូវការជាក់ស្តែង
        function getGrade(percentage) {
            if (percentage >= 90) return 'A';
            if (percentage >= 80) return 'B';
            if (percentage >= 70) return 'C';
            if (percentage >= 60) return 'D';
            if (percentage >= 50) return 'E';
            return 'F';
        }

        // មុខងារសម្រាប់បង្កើត input fields មុខវិជ្ជាទៅតាមថ្នាក់ដែលបានជ្រើសរើស
        function generateSubjectInputs(stream) {
            const subjectInputsDiv = document.getElementById('subjectInputs');
            subjectInputsDiv.innerHTML = ''; // លុប input fields ចាស់ចេញ

            // ប្រសិនបើគ្មានថ្នាក់ត្រូវបានជ្រើសរើស នោះមិនចាំបាច់បង្កើត input ទេ
            if (!stream) {
                return;
            }

            const currentSubjects = subjects[stream];
            if (currentSubjects) {
                currentSubjects.forEach((subject, index) => {
                    const div = document.createElement('div');
                    // កំណត់ Class របស់ Tailwind សម្រាប់រចនាបថ input group
                    div.className = 'relative flex items-center justify-between p-4 bg-white border border-gray-300 rounded-lg shadow-sm';
                    div.innerHTML = `
                        <label for="subject-${index}" class="text-gray-800 text-lg font-medium">${subject.name}:</label>
                        <input type="number" id="subject-${index}" data-max="${subject.max}" data-name="${subject.name}"
                               class="w-24 p-2 border border-gray-300 rounded-md text-center focus:ring-1 focus:ring-blue-400 focus:border-transparent transition duration-150"
                               placeholder="0-${subject.max}" min="0" max="${subject.max}">
                    `;
                    subjectInputsDiv.appendChild(div);
                });
            }
        }

        // មុខងារសម្រាប់គណនាលទ្ធផលទាំងអស់
        function calculateResults() {
            const studentName = document.getElementById('studentName').value.trim();
            // ផ្ទៀងផ្ទាត់ការបញ្ចូលឈ្មោះសិស្ស
            if (!studentName) {
                showMessage('សូមបញ្ចូលឈ្មោះសិស្ស!', 'red'); // បង្ហាញសារកំហុសបើឈ្មោះទទេ
                return;
            }

            const stream = document.getElementById('streamSelect').value;
            // ផ្ទៀងផ្ទាត់ការជ្រើសរើសថ្នាក់
            if (!stream) {
                showMessage('សូមជ្រើសរើសថ្នាក់!', 'red'); // បង្ហាញសារកំហុសបើគ្មានថ្នាក់ត្រូវបានជ្រើសរើស
                return;
            }

            const currentSubjects = subjects[stream];
            let totalScoreObtained = 0; // ពិន្ទុដែលទទួលបានសរុប
            let totalPossibleScore = 0; // ពិន្ទុអតិបរមាសរុប
            const individualResultsDiv = document.getElementById('individualResults');
            individualResultsDiv.innerHTML = ''; // លុបលទ្ធផលមុខវិជ្ជានីមួយៗចាស់ចេញ

            let allInputsValid = true;

            // វិភាគរាល់មុខវិជ្ជាដើម្បីគណនាលទ្ធផលរៀងៗខ្លួន
            currentSubjects.forEach((subject, index) => {
                const inputElement = document.getElementById(`subject-${index}`);
                // ធានាថា input element មាន
                if (!inputElement) {
                    console.error(`Input element for ${subject.name} not found.`);
                    allInputsValid = false;
                    return; // រំលងការគណនាសម្រាប់មុខវិជ្ជានេះ
                }

                const score = parseFloat(inputElement.value);
                const maxScore = subject.max;

                // ផ្ទៀងផ្ទាត់ពិន្ទុមុខវិជ្ជានីមួយៗ
                if (isNaN(score) || score < 0 || score > maxScore) {
                    showMessage(`សូមបញ្ចូលពិន្ទុត្រឹមត្រូវសម្រាប់ ${subject.name} (0-${maxScore})!`, 'red');
                    inputElement.classList.add('border-red-500'); // បន្លិច input field ដែលមិនត្រឹមត្រូវ
                    allInputsValid = false;
                    // មិន return នៅទីនេះទេ ដើម្បីបន្តផ្ទៀងផ្ទាត់ input ផ្សេងទៀត
                } else {
                    inputElement.classList.remove('border-red-500'); // លុបការបន្លិចបើ input ត្រឹមត្រូវ
                }

                // គណនាបានតែប្រសិនបើ input ត្រឹមត្រូវសម្រាប់មុខវិជ្ជានេះ
                if (!isNaN(score) && score >= 0 && score <= maxScore) {
                    const percentage = (score / maxScore) * 100;
                    const grade = getGrade(percentage);

                    totalScoreObtained += score;
                    totalPossibleScore += maxScore;

                    // បង្កើតនិងបន្ថែមការបង្ហាញលទ្ធផលមុខវិជ្ជានីមួយៗ
                    const resultItem = document.createElement('div');
                    resultItem.className = 'p-4 bg-white border border-gray-200 rounded-lg shadow-sm';
                    resultItem.innerHTML = `
                        <p class="text-lg font-semibold text-gray-800">${subject.name}:</p>
                        <p class="text-gray-700">ពិន្ទុ: <span class="font-medium">${score}/${maxScore}</span></p>
                        <p class="text-gray-700">ភាគរយ: <span class="font-medium">${percentage.toFixed(2)}%</span></p>
                        <p class="text-gray-700">និទ្ទេស: <span class="font-bold text-green-600">${grade}</span></p>
                    `;
                    individualResultsDiv.appendChild(resultItem);
                }
            });

            // ប្រសិនបើ input ណាមួយមិនត្រឹមត្រូវ សូមបញ្ឈប់ការគណនាលទ្ធផលសរុប
            if (!allInputsValid) {
                document.getElementById('totalScoreDisplay').textContent = '0';
                document.getElementById('overallPercentageDisplay').textContent = '0.00%';
                document.getElementById('overallGradeDisplay').textContent = 'F';
                return;
            }

            // គណនា និងបង្ហាញលទ្ធផលសរុប
            const overallPercentage = (totalScoreObtained / totalPossibleScore) * 100;
            const overallGrade = getGrade(overallPercentage);

            document.getElementById('totalScoreDisplay').textContent = totalScoreObtained.toFixed(2);
            document.getElementById('overallPercentageDisplay').textContent = `${overallPercentage.toFixed(2)}%`;
            document.getElementById('overallGradeDisplay').textContent = overallGrade;

            showMessage('គណនាពិន្ទុបានជោគជ័យ!', 'green'); // បង្ហាញសារជោគជ័យ
        }

        // មុខងារសម្រាប់កំណត់ទម្រង់ឡើងវិញ
        function resetForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('streamSelect').value = '';
            document.getElementById('subjectInputs').innerHTML = ''; // លុប input មុខវិជ្ជាដែលបានបង្កើតដោយស្វ័យប្រវត្តិ
            document.getElementById('individualResults').innerHTML = ''; // លុបការបង្ហាញលទ្ធផលរៀងៗខ្លួន
            document.getElementById('totalScoreDisplay').textContent = '0'; // កំណត់ការបង្ហាញពិន្ទុសរុបឡើងវិញ
            document.getElementById('overallPercentageDisplay').textContent = '0.00%'; // កំណត់ការបង្ហាញភាគរយសរុបឡើងវិញ
            document.getElementById('overallGradeDisplay').textContent = 'F'; // កំណត់ការបង្ហាញនិទ្ទេសសរុបឡើងវិញ
            hideMessage(); // លាក់សារណាមួយដែលកំពុងបង្ហាញ
        }

        // មុខងារសម្រាប់បង្ហាញសារជូនដំណឹងផ្ទាល់ខ្លួន (Toast Notification)
        function showMessage(message, type) {
            // លុបសារដែលមានស្រាប់ ដើម្បីជៀសវាងការជាន់គ្នា
            hideMessage();

            const messageBox = document.createElement('div');
            // អនុវត្ត Class របស់ Tailwind សម្រាប់រចនាបថ និងការកំណត់ទីតាំង
            messageBox.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white font-semibold z-50 transition-transform transform duration-300 ease-out ${
                type === 'red' ? 'bg-red-500' : 'bg-green-500'
            }`;
            messageBox.textContent = message;
            document.body.appendChild(messageBox);

            // ធ្វើឱ្យ message box រអិលចូលពីខាងស្តាំ
            requestAnimationFrame(() => {
                messageBox.style.transform = 'translateX(0)';
            });

            // លុបសារដោយស្វ័យប្រវត្តិបន្ទាប់ពី 3 វិនាទី
            setTimeout(() => {
                messageBox.classList.add('translate-x-full'); // ធ្វើឱ្យរអិលចេញទៅខាងស្តាំ
                messageBox.addEventListener('transitionend', () => messageBox.remove()); // លុបពី DOM បន្ទាប់ពី animation បញ្ចប់
            }, 3000);
        }

        // មុខងារសម្រាប់លាក់សារជូនដំណឹងផ្ទាល់ខ្លួន
        function hideMessage() {
            const existingMessage = document.querySelector('.fixed.top-4.right-4');
            if (existingMessage) {
                existingMessage.remove();
            }
        }

        // Event listener សម្រាប់ DOMContentLoaded ធានាថា script ដំណើរការបន្ទាប់ពី HTML ផ្ទុកពេញលេញ
        document.addEventListener('DOMContentLoaded', () => {
            const streamSelect = document.getElementById('streamSelect');
            const calculateBtn = document.getElementById('calculateBtn');
            const resetBtn = document.getElementById('resetBtn');

            // Event listener សម្រាប់ការផ្លាស់ប្តូរនៅក្នុង dropdown ជ្រើសរើសថ្នាក់
            streamSelect.addEventListener('change', (event) => {
                generateSubjectInputs(event.target.value); // បង្កើត input មុខវិជ្ជាឡើងវិញតាមថ្នាក់ដែលបានជ្រើសរើស
            });

            // Event listeners សម្រាប់ប៊ូតុង "គណនា" និង "កំណត់ឡើងវិញ"
            calculateBtn.addEventListener('click', calculateResults);
            resetBtn.addEventListener('click', resetForm);

            // បង្កើត input មុខវិជ្ជាដំបូង ប្រសិនបើមានថ្នាក់ត្រូវបានជ្រើសរើសរួចហើយ (ទោះបីជាក្នុងករណីនេះមិនមានក៏ដោយ)
            generateSubjectInputs(streamSelect.value);
        });
    </script>
</body>
</html>
